<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî Attribution Calculator</title>
    <link rel="stylesheet" href="style_v35.css?v=6.0">
    <link rel="stylesheet" href="upload_style.css" id="uploadStyleLink">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Top Nav Bar -->
    <nav class="top-nav">
        <div class="top-nav-inner">
            <a href="index.html" class="nav-tab">
                <span>‚öôÔ∏è</span> –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
            </a>
            <a href="upload.html" class="nav-tab active">
                <span>üìÅ</span> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="upload-page-wrapper">
        <div class="upload-main-card">
            <!-- Header -->
            <div class="upload-card-header">
                <div class="header-icon">üìÅ</div>
                <div>
                    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
                    <p class="header-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª —Å –ª–∏—Å—Ç–∞–º–∏ –∫–∞–Ω–∞–ª–æ–≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –∏ –≤—ã–¥–∞—á–∞–º–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
                    </p>
                </div>
            </div>

            <!-- File Info (shown after file selected) -->
            <div class="upload-info" id="uploadInfo" style="display:none;">
                <div class="file-info">
                    <span class="file-icon">‚úÖ</span>
                    <div class="file-details">
                        <span class="file-name" id="fileName"></span>
                        <span class="file-meta" id="fileMeta"></span>
                    </div>
                    <button class="clear-file-btn" id="clearFileBtn">‚úï –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>

            <!-- Loading Status -->
            <div class="loading-status" id="loadingStatus" style="display:none;">
                <div class="loading-spinner"></div>
                <span>–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...</span>
            </div>

            <!-- Drop Zone (hidden after file selected) -->
            <div class="upload-dropzone" id="dropzone">
                <div class="dropzone-content">
                    <div class="dropzone-icon">üìä</div>
                    <h2>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Excel —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <span class="dropzone-link">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</span></h2>
                    <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è .xlsx, .xls —Å –ª–∏—Å—Ç–∞–º–∏: cash_loan + –∫–∞–Ω–∞–ª—ã (stories, push, sms, telemarket, banner,
                        digital)</p>
                </div>
                <input type="file" id="fileInput" accept=".xlsx,.xls" hidden>
            </div>

            <!-- Detected Channels Summary (auto-filled after file load) -->
            <div class="channels-summary" id="channelsSummary" style="display:none;">
                <div class="mapping-section-header">
                    <span class="mapping-icon">üì°</span>
                    <h3>–û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ö–ê–ù–ê–õ–´</h3>
                </div>
                <div class="channels-stats-grid" id="channelsGrid"></div>
            </div>

            <!-- Channel Scores -->
            <div class="channel-scores-section" id="channelScoresSection" style="display:none;">
                <div class="scores-header">
                    <span class="field-icon">üéØ</span>
                    <h4>–ë–∞–ª–ª—ã –∫–∞–Ω–∞–ª–æ–≤</h4>
                    <span class="scores-hint">–î–ª—è Weighted Score –º–æ–¥–µ–ª–∏</span>
                </div>
                <div class="scores-grid" id="channelScoresGrid"></div>
            </div>

            <button class="run-analysis-btn" id="runAnalysisBtn" style="display:none;">
                <span class="arrow">‚ñ∂</span> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ü–∏—é
            </button>
        </div>

        <!-- Data Preview Card -->
        <div class="preview-card" id="previewCard" style="display:none;">
            <div class="preview-header">
                <span class="icon">‚öô</span>
                <h3>–ü–†–ï–î–ü–†–û–°–ú–û–¢–† –î–ê–ù–ù–´–•</h3>
                <span class="preview-count" id="previewCount"></span>
            </div>
            <div class="preview-table-wrapper">
                <table class="preview-table" id="previewTable">
                    <thead id="previewHead"></thead>
                    <tbody id="previewBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="upload-results-section" id="resultsSection" style="display:none;">

        <!-- Summary Cards -->
        <div class="sim-cards-grid">
            <div class="sim-card">
                <div class="card-label">–ö–õ–ò–ï–ù–¢–´ –° –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–Ø–ú–ò</div>
                <div class="card-value" id="rTotalClients">0</div>
                <div class="card-sub text-green" id="rTotalClientsSub">—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π</div>
            </div>
            <div class="sim-card">
                <div class="card-label">–£–ù–ò–ö–ê–õ–¨–ù–´–• –ö–ê–ù–ê–õ–û–í</div>
                <div class="card-value" id="rUniqueChannels">0</div>
                <div class="card-sub text-gray" id="rChannelsList"></div>
            </div>
            <div class="sim-card">
                <div class="card-label">–°–ê–ú–´–ô –ß–ê–°–¢–´–ô –ü–£–¢–¨</div>
                <div class="card-value sm" id="rTopPath">‚Äî</div>
                <div class="card-sub text-gray" id="rTopPathPercent"></div>
            </div>
            <div class="sim-card">
                <div class="card-label">–°–†–ï–î–ù–Ø–Ø –î–õ–ò–ù–ê –ü–£–¢–ò</div>
                <div class="card-value" id="rAvgLength">0</div>
                <div class="card-sub text-gray">–∫–∞—Å–∞–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞</div>
            </div>
        </div>

        <!-- Attribution Models (4 cards) -->
        <div class="upload-models-grid">
            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üìä</span>
                    <div>
                        <h3>Weighted Score</h3>
                        <p class="model-subtitle">–î–æ–ª—è = –ë–∞–ª–ª –∫–∞–Ω–∞–ª–∞ / –°—É–º–º–∞ –±–∞–ª–ª–æ–≤</p>
                    </div>
                </div>
                <div class="model-results-scroll">
                    <div class="results-list" id="uploadWeightedResults"></div>
                </div>
            </div>

            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üèîÔ∏è</span>
                    <div>
                        <h3>U-Shape (Position Based)</h3>
                        <p class="model-subtitle">40% –ü–µ—Ä–≤–æ–º—É / 40% –ü–æ—Å–ª–µ–¥–Ω–µ–º—É / 20% –°–µ—Ä–µ–¥–∏–Ω–µ</p>
                    </div>
                </div>
                <div class="model-results-scroll">
                    <div class="results-list" id="uploadUShapeResults"></div>
                </div>
            </div>

            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üëÜ</span>
                    <div>
                        <h3>Last Touch</h3>
                        <p class="model-subtitle">100% –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫–∞–Ω–∞–ª—É</p>
                    </div>
                </div>
                <div class="model-results-scroll">
                    <div class="results-list" id="uploadLastTouchResults"></div>
                </div>
            </div>

            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üéØ</span>
                    <div>
                        <h3>First Touch</h3>
                        <p class="model-subtitle">100% –ø–µ—Ä–≤–æ–º—É –∫–∞–Ω–∞–ª—É</p>
                    </div>
                </div>
                <div class="model-results-scroll">
                    <div class="results-list" id="uploadFirstTouchResults"></div>
                </div>
            </div>
        </div>

        <!-- Comparison Bars -->
        <div class="sim-chart-section">
            <div class="section-title">
                <span class="icon-bar">üìä</span> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∞ (–ê—Ç—Ä–∏–±—É—Ü–∏—è –ø—Ä–æ–¥–∞–∂)
            </div>
            <div id="uploadBarsContainer" class="sim-bars-container"></div>
            <div class="sim-legend">
                <div class="legend-item"><span class="dot l-gray"></span> Last Touch</div>
                <div class="legend-item"><span class="dot l-green"></span> First Touch</div>
                <div class="legend-item"><span class="dot l-purple"></span> Weighted Score</div>
                <div class="legend-item"><span class="dot l-blue"></span> U-Shape</div>
            </div>
        </div>

        <!-- Top Scenarios Table -->
        <div class="sim-table-section">
            <div class="section-title">
                <span class="icon">üìã</span>
                <h3>–í–°–ï –°–¶–ï–ù–ê–†–ò–ò (–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø)</h3>
            </div>
            <div class="scenarios-table-scroll">
                <table class="sim-table">
                    <thead>
                        <tr>
                            <th>–ü—É—Ç—å</th>
                            <th class="col-number">–ö–û–õ-–í–û</th>
                            <th class="col-number">–ü–†–û–¶–ï–ù–¢</th>
                        </tr>
                    </thead>
                    <tbody id="uploadTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Analytical Insight -->
        <div class="sim-insight-section">
            <div class="insight-icon">üí°</div>
            <div class="insight-content">
                <h3>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥</h3>
                <div id="uploadInsightText">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
                </div>
            </div>
        </div>
    </div>

    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script>
        // Force cache bust
        var ts = Date.now();
        document.getElementById('uploadStyleLink').href = 'upload_style.css?t=' + ts;
        var s = document.createElement('script');
        s.src = 'upload_script.js?t=' + ts;
        s.onload = function() { init(); };
        document.body.appendChild(s);
    </script>
</body>

</html>