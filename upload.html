<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî Attribution Calculator</title>
    <link rel="stylesheet" href="style_v35.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <a href="index.html" class="nav-link">‚öôÔ∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</a>
        <a href="upload.html" class="nav-link active">üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</a>
    </nav>

    <div class="upload-page">
        <!-- Upload Section -->
        <div class="upload-container">
            <div class="upload-header">
                <span class="icon">üìÅ</span>
                <div>
                    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
                    <p class="upload-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel –∏–ª–∏ CSV —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                </div>
            </div>

            <!-- Drop Zone -->
            <div class="drop-zone" id="dropZone">
                <div class="drop-zone-content">
                    <div class="drop-icon">üìÑ</div>
                    <p class="drop-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <label for="fileInput" class="file-label">–≤—ã–±–µ—Ä–∏—Ç–µ
                            —Ñ–∞–π–ª</label></p>
                    <p class="drop-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è .xlsx, .xls, .csv</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" hidden>
                </div>
            </div>

            <!-- File Info (after upload) -->
            <div class="file-info hidden" id="fileInfo">
                <div class="file-info-left">
                    <span class="file-icon">‚úÖ</span>
                    <div>
                        <div class="file-name" id="fileName">‚Äî</div>
                        <div class="file-meta" id="fileMeta">‚Äî</div>
                    </div>
                </div>
                <button class="clear-file-btn" id="clearFileBtn">‚úï –£–¥–∞–ª–∏—Ç—å</button>
            </div>

            <!-- Sheet Selector (for multi-sheet Excel) -->
            <div class="sheet-selector hidden" id="sheetSelector">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç:</label>
                <select id="sheetSelect"></select>
            </div>

            <!-- Column Mapping -->
            <div class="column-mapping hidden" id="columnMapping">
                <div class="section-header">
                    <span class="icon">üîó</span>
                    <h2>–ú–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫</h2>
                </div>
                <p class="mapping-hint">–£–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –≤–∞—à–µ–º —Ñ–∞–π–ª–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω—É–∂–Ω—ã–º –ø–æ–ª—è–º</p>
                <div class="mapping-grid">
                    <div class="mapping-item">
                        <label>üÜî ID –ö–ª–∏–µ–Ω—Ç–∞</label>
                        <select id="mapClientId"></select>
                    </div>
                    <div class="mapping-item">
                        <label>üì° –ö–∞–Ω–∞–ª –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</label>
                        <select id="mapChannel"></select>
                    </div>
                    <div class="mapping-item">
                        <label>üïê –î–∞—Ç–∞ / –í—Ä–µ–º—è</label>
                        <select id="mapTimestamp"></select>
                    </div>
                </div>
                <button class="process-btn" id="processBtn">
                    <span class="arrow">‚ñ∂</span> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ü–∏—é
                </button>
            </div>

            <!-- Data Preview -->
            <div class="data-preview hidden" id="dataPreview">
                <div class="section-header">
                    <span class="icon">üëÅÔ∏è</span>
                    <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</h2>
                    <span class="preview-badge" id="previewBadge">–ü–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫</span>
                </div>
                <div class="preview-table-wrapper">
                    <table class="preview-table" id="previewTable">
                        <thead id="previewHead"></thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Results Section (hidden until processed) -->
        <div class="upload-results hidden" id="uploadResults">
            <!-- Summary Cards -->
            <div class="sim-cards-grid">
                <div class="sim-card">
                    <div class="card-label">–í–°–ï–ì–û –ö–õ–ò–ï–ù–¢–û–í</div>
                    <div class="card-value" id="upTotalClients">‚Äî</div>
                    <div class="card-sub text-gray" id="upTotalClientsSub">—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID</div>
                </div>
                <div class="sim-card">
                    <div class="card-label">–í–°–ï–ì–û –ö–ê–°–ê–ù–ò–ô</div>
                    <div class="card-value" id="upTotalTouches">‚Äî</div>
                    <div class="card-sub text-gray" id="upTotalTouchesSub">—Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª–µ</div>
                </div>
                <div class="sim-card">
                    <div class="card-label">–°–†–ï–î–ù–Ø–Ø –î–õ–ò–ù–ê –ü–£–¢–ò</div>
                    <div class="card-value" id="upAvgLength">‚Äî</div>
                    <div class="card-sub text-gray">–∫–∞—Å–∞–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞</div>
                </div>
                <div class="sim-card">
                    <div class="card-label">–°–ê–ú–´–ô –ß–ê–°–¢–´–ô –ü–£–¢–¨</div>
                    <div class="card-value sm" id="upTopPath">‚Äî</div>
                    <div class="card-sub text-gray" id="upTopPathPercent">‚Äî</div>
                </div>
            </div>

            <!-- 4 Model Results -->
            <div class="upload-models-grid">
                <!-- Weighted Score -->
                <div class="attribution-model">
                    <div class="model-header">
                        <span class="icon-bar">üìä</span>
                        <div>
                            <h3>Weighted Score</h3>
                            <p class="model-subtitle">–î–æ–ª—è = –ë–∞–ª–ª –∫–∞–Ω–∞–ª–∞ / –°—É–º–º–∞ –±–∞–ª–ª–æ–≤</p>
                        </div>
                    </div>
                    <div class="results-list" id="upWeightedResults"></div>
                </div>

                <!-- U-Shape -->
                <div class="attribution-model">
                    <div class="model-header">
                        <span class="icon-bar">üèîÔ∏è</span>
                        <div>
                            <h3>U-Shape (Position Based)</h3>
                            <p class="model-subtitle">40% –ü–µ—Ä–≤–æ–º—É / 40% –ü–æ—Å–ª–µ–¥–Ω–µ–º—É / 20% –°–µ—Ä–µ–¥–∏–Ω–µ</p>
                        </div>
                    </div>
                    <div class="results-list" id="upUShapeResults"></div>
                </div>

                <!-- Last Touch -->
                <div class="attribution-model">
                    <div class="model-header">
                        <span class="icon-bar">üëÜ</span>
                        <div>
                            <h3>Last Touch</h3>
                            <p class="model-subtitle">100% –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫–∞–Ω–∞–ª—É</p>
                        </div>
                    </div>
                    <div class="results-list" id="upLastTouchResults"></div>
                </div>

                <!-- First Touch -->
                <div class="attribution-model">
                    <div class="model-header">
                        <span class="icon-bar">üéØ</span>
                        <div>
                            <h3>First Touch</h3>
                            <p class="model-subtitle">100% –ø–µ—Ä–≤–æ–º—É –∫–∞–Ω–∞–ª—É</p>
                        </div>
                    </div>
                    <div class="results-list" id="upFirstTouchResults"></div>
                </div>
            </div>

            <!-- Comparison Bars -->
            <div class="sim-chart-section">
                <div class="section-title">
                    <span class="icon-bar">üìä</span> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∞ (–ê—Ç—Ä–∏–±—É—Ü–∏—è –ø—Ä–æ–¥–∞–∂)
                </div>
                <div id="upBarsContainer" class="sim-bars-container"></div>
                <div class="sim-legend">
                    <div class="legend-item"><span class="dot l-gray"></span> Last Touch</div>
                    <div class="legend-item"><span class="dot l-green"></span> Weighted Score</div>
                    <div class="legend-item"><span class="dot l-blue"></span> U-Shape</div>
                    <div class="legend-item"><span class="dot l-orange"></span> First Touch</div>
                </div>
            </div>

            <!-- Scenarios Table -->
            <div class="sim-table-section">
                <div class="section-title">
                    <span class="icon">üìã</span>
                    <h3>–í–°–ï –°–¶–ï–ù–ê–†–ò–ò (–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø)</h3>
                </div>
                <table class="sim-table">
                    <thead>
                        <tr>
                            <th>–ü—É—Ç—å</th>
                            <th class="col-number">–ö–û–õ-–í–û</th>
                            <th class="col-number">–ü–†–û–¶–ï–ù–¢</th>
                        </tr>
                    </thead>
                    <tbody id="upTableBody"></tbody>
                </table>
            </div>

            <!-- Analytical Insight -->
            <div class="sim-insight-section">
                <div class="insight-icon">üí°</div>
                <div class="insight-content">
                    <h3>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥</h3>
                    <div id="upInsightText">‚Äî</div>
                </div>
            </div>
        </div>
    </div>

    <!-- SheetJS for Excel/CSV parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <script src="upload_script.js"></script>
</body>

</html>