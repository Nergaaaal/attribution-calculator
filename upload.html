<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî Attribution Calculator</title>
    <link rel="stylesheet" href="style_v35.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="upload-nav">
        <a href="index.html" class="nav-back-btn">
            <span>‚Üê</span> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
        </a>
        <div class="nav-title">
            <span class="nav-icon">üìÅ</span>
            <h1>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
        </div>
        <div class="nav-spacer"></div>
    </nav>

    <!-- Upload Zone -->
    <div class="upload-container">
        <div class="upload-card">
            <div class="upload-dropzone" id="dropzone">
                <div class="dropzone-content">
                    <div class="dropzone-icon">üìÑ</div>
                    <h2>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</h2>
                    <p>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
                    <div class="dropzone-formats">
                        <span class="format-badge">.xlsx</span>
                        <span class="format-badge">.csv</span>
                    </div>
                </div>
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" hidden>
            </div>

            <div class="upload-info" id="uploadInfo" style="display:none;">
                <div class="file-info">
                    <span class="file-icon">‚úÖ</span>
                    <div class="file-details">
                        <span class="file-name" id="fileName"></span>
                        <span class="file-meta" id="fileMeta"></span>
                    </div>
                    <button class="clear-file-btn" id="clearFileBtn">‚úï</button>
                </div>
            </div>

            <!-- Column Mapping -->
            <div class="column-mapping" id="columnMapping" style="display:none;">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–æ–ª–±—Ü–æ–≤</h3>
                <p class="mapping-hint">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ–ª–±—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ –æ –∫–∞–Ω–∞–ª–∞—Ö –∏ –∫–ª–∏–µ–Ω—Ç–∞—Ö</p>

                <div class="mapping-grid">
                    <div class="mapping-item">
                        <label>–°—Ç–æ–ª–±–µ—Ü —Å ID –∫–ª–∏–µ–Ω—Ç–∞</label>
                        <select id="colClientId" class="mapping-select"></select>
                    </div>
                    <div class="mapping-item">
                        <label>–°—Ç–æ–ª–±—Ü—ã —Å –∫–∞–Ω–∞–ª–∞–º–∏ (touchpoints)</label>
                        <div class="channel-cols-list" id="channelColsList"></div>
                    </div>
                </div>

                <button class="run-analysis-btn" id="runAnalysisBtn">
                    <span class="arrow">‚ñ∂</span> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ü–∏—é
                </button>
            </div>
        </div>

        <!-- Data Preview -->
        <div class="preview-card" id="previewCard" style="display:none;">
            <div class="preview-header">
                <span class="icon">üëÄ</span>
                <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</h3>
                <span class="preview-count" id="previewCount"></span>
            </div>
            <div class="preview-table-wrapper">
                <table class="preview-table" id="previewTable">
                    <thead id="previewHead"></thead>
                    <tbody id="previewBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="upload-results-section" id="resultsSection" style="display:none;">

        <!-- Summary Cards -->
        <div class="sim-cards-grid">
            <div class="sim-card">
                <div class="card-label">–í–°–ï–ì–û –ö–õ–ò–ï–ù–¢–û–í</div>
                <div class="card-value" id="rTotalClients">0</div>
                <div class="card-sub text-green" id="rTotalClientsSub">—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π</div>
            </div>
            <div class="sim-card">
                <div class="card-label">–£–ù–ò–ö–ê–õ–¨–ù–´–• –ö–ê–ù–ê–õ–û–í</div>
                <div class="card-value" id="rUniqueChannels">0</div>
                <div class="card-sub text-gray" id="rChannelsList"></div>
            </div>
            <div class="sim-card">
                <div class="card-label">–°–ê–ú–´–ô –ß–ê–°–¢–´–ô –ü–£–¢–¨</div>
                <div class="card-value sm" id="rTopPath">‚Äî</div>
                <div class="card-sub text-gray" id="rTopPathPercent"></div>
            </div>
            <div class="sim-card">
                <div class="card-label">–°–†–ï–î–ù–Ø–Ø –î–õ–ò–ù–ê –ü–£–¢–ò</div>
                <div class="card-value" id="rAvgLength">0</div>
                <div class="card-sub text-gray">–∫–∞—Å–∞–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞</div>
            </div>
        </div>

        <!-- Attribution Models (4 cards) -->
        <div class="upload-models-grid">
            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üìä</span>
                    <div>
                        <h3>Weighted Score</h3>
                        <p class="model-subtitle">–î–æ–ª—è = –ë–∞–ª–ª –∫–∞–Ω–∞–ª–∞ / –°—É–º–º–∞ –±–∞–ª–ª–æ–≤</p>
                    </div>
                </div>
                <div class="results-list" id="uploadWeightedResults"></div>
            </div>

            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üèîÔ∏è</span>
                    <div>
                        <h3>U-Shape (Position Based)</h3>
                        <p class="model-subtitle">40% –ü–µ—Ä–≤–æ–º—É / 40% –ü–æ—Å–ª–µ–¥–Ω–µ–º—É / 20% –°–µ—Ä–µ–¥–∏–Ω–µ</p>
                    </div>
                </div>
                <div class="results-list" id="uploadUShapeResults"></div>
            </div>

            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üëÜ</span>
                    <div>
                        <h3>Last Touch</h3>
                        <p class="model-subtitle">100% –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫–∞–Ω–∞–ª—É</p>
                    </div>
                </div>
                <div class="results-list" id="uploadLastTouchResults"></div>
            </div>

            <div class="attribution-model">
                <div class="model-header">
                    <span class="icon-bar">üéØ</span>
                    <div>
                        <h3>First Touch</h3>
                        <p class="model-subtitle">100% –ø–µ—Ä–≤–æ–º—É –∫–∞–Ω–∞–ª—É</p>
                    </div>
                </div>
                <div class="results-list" id="uploadFirstTouchResults"></div>
            </div>
        </div>

        <!-- Comparison Bars -->
        <div class="sim-chart-section">
            <div class="section-title">
                <span class="icon-bar">üìä</span> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∞ (–ê—Ç—Ä–∏–±—É—Ü–∏—è –ø—Ä–æ–¥–∞–∂)
            </div>
            <div id="uploadBarsContainer" class="sim-bars-container"></div>
            <div class="sim-legend">
                <div class="legend-item"><span class="dot l-gray"></span> Last Touch</div>
                <div class="legend-item"><span class="dot l-green"></span> First Touch</div>
                <div class="legend-item"><span class="dot l-purple"></span> Weighted Score</div>
                <div class="legend-item"><span class="dot l-blue"></span> U-Shape</div>
            </div>
        </div>

        <!-- Top Scenarios Table -->
        <div class="sim-table-section">
            <div class="section-title">
                <span class="icon">üìã</span>
                <h3>–í–°–ï –°–¶–ï–ù–ê–†–ò–ò (–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø)</h3>
            </div>
            <table class="sim-table">
                <thead>
                    <tr>
                        <th>–ü—É—Ç—å</th>
                        <th class="col-number">–ö–û–õ-–í–û</th>
                        <th class="col-number">–ü–†–û–¶–ï–ù–¢</th>
                    </tr>
                </thead>
                <tbody id="uploadTableBody"></tbody>
            </table>
        </div>

        <!-- Analytical Insight -->
        <div class="sim-insight-section">
            <div class="insight-icon">üí°</div>
            <div class="insight-content">
                <h3>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥</h3>
                <div id="uploadInsightText">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
                </div>
            </div>
        </div>
    </div>

    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="upload_script.js"></script>
</body>

</html>